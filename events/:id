<div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-4 col-md-3" id="sidebar">
            <h1><a href="../events" data-i18n="nav.events"></a></h1>
            <center id="cal1" class="cal1">
                <div class="date" id="clndr"></div>
            </center>
        </div>
        <div class="col-xs-12 col-sm-8 col-md-9" id="right-content">
            <div class="events" id="events_details_id">
                <!-- START MUSTACHE TEMPLATE FOR EVENT ITEM-->
                <script id="event_details_template" type="x-tmpl-mustache">
                    <div class="event-details">
                        <div class="event-name">
                            <h3>{{ name }}</h3>
                        </div>
                        <div class="event-dates">
                            {{ start_date }} to {{ end_date }}
                        </div>
                        <div class="event-description">
                            {{{ rich_description }}}
                        </div>
                        <div class="social-links detail-social">
                            <span style="margin-right:10px;"><a href="https://www.facebook.com/sharer.php?u=https://londonderrymall.com/events/{{slug}}" target="_blank">
                                <img src="https://kodekloud.s3.amazonaws.com/sites/54612c496e6f6474ba020000/3dde114989a7fcfddac2cc3f1341764a/facebook.png" class="" alt="">
                            </a></span>
                            <span><a href="https://twitter.com/?status={{name}}%20%20https://londonderrymall.com/events/{{slug}}" target="_blank">
                                <img src="https://kodekloud.s3.amazonaws.com/sites/54612c496e6f6474ba020000/3dde114989a7fcfddac2cc3f1341764a/twitter.png" class="" alt="">
                           </a></span>
                        </div>
                        <div class="event-image">
                            <img src="{{event_image_url_abs}}">
                        </div>
                    </div>
                </script>
                <!-- END MUSTACHE TEMPLATE FOR EVENT ITEM-->
                    
            </div>
        </div>
       
    </div>
</div>

<script>

    $(document).ready(function() {
        
        function renderPageData(){
           //renders the events list by referencing the template id and the html id
            //for where to place the rendered content. See mallmaverick.js for implementation
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            var event_details = getEventDetailsBySlug(slug);
                checkErrorPage(event_details);
            renderEventDetailsTemplate('#event_details_template','#events_details_id',event_details);
        
            //please see https://kylestetz.github.io/CLNDR/
            $('#clndr').clndr({
                events:getEventsList(),
                  multiDayEvents: {
                    startDate: 'start_date',
                    endDate: 'end_date'
                  },
                  clickEvents: {
                    click: function(target) {
                      
                    },
                    onMonthChange: function(month) {
                      $('.clndr-previous-button').html("<");
                      $('.clndr-next-button').html(">");
                    }
                  },
                  doneRendering: function() {
                    
                  }
            });
            
            $('.clndr-previous-button').html("<");
            $('.clndr-next-button').html(">");
            $('#loading').hide();
            $('#page_content').fadeIn('fast');
            
            
             $.ajax({
                url : "/web_pages/update_dynamic_page_meta_data",
                type: "POST",
                data : {authenticity_token: '<%=form_authenticity_token%>' ,
                        web_page_id: '<%=web_page_id%>', path:window.location.pathname,
                        meta_lang:'EN',
                        meta_title:"Londonderry Mall | " + event_details.name,
                        meta_description:   event_details.name + event_details.description,
                        meta_keywords:''
                        
                        
                },
                success: function(data, textStatus, jqXHR)
                {
                    
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    
                }
            });
        }
        
        loadMallData(renderPageData);
    });
        jQuery(window).scroll(function(){ 
        var navHeight = $('nav').height();
        var windowTop = $(window).scrollTop() - navHeight; 
        var sidebarHeight = $('#sidebar').height();
        var contentHeight = $('#right-content').height();
        if(sidebarHeight + windowTop < contentHeight){
            if ($(window).scrollTop() > 140) {
                jQuery('#sidebar').css('top',windowTop); 
            }else{
                jQuery('#sidebar').css('top',0);
            }
        }
  
    });

</script>